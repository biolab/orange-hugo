<html><head><title>Orange Data Mining - Making recommendations</title><meta property="og:title" content="Making recommendations"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Orange Data Mining Toolbox"><meta name=author content="Bioinformatics Laboratory, University of Ljubljana"><meta name=google-site-verification content="DS7GH5M7ABi78pIC2rMcTBFx-UeBFObXOeLvR7Ow3EQ"><link rel="shortcut icon" href=/images/favicon.ico><link href='https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic' rel=stylesheet type=text/css><link href='https://fonts.googleapis.com/css?family=Covered+By+Your+Grace' rel=stylesheet type=text/css><link rel=stylesheet href=/plugins/bootstrap/css/bootstrap.min.css><link rel=stylesheet href=/plugins/font-awesome/css/font-awesome.css><link rel=stylesheet href=/plugins/lightgallery/css/lightgallery.css><link href=https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css rel=stylesheet><link rel=stylesheet href=/scss/main.58e8531e166454b3665e4c7132aa2f1762a5569c179efa4bbf56b266ce93bfac.css><script id=dsq-count-scr src=//orange-4.disqus.com/count.js async></script><noscript><style>.jsonly{display:none!important}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-J6PJZF75EX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J6PJZF75EX",{anonymize_ip:!1})}</script><script type=text/javascript src=/plugins/jquery-1.10.2.min.js></script>
<script type=text/javascript src=/plugins/jquery.form.js></script>
<script type=text/javascript src=/plugins/bootstrap/js/bootstrap.min.js></script>
<script type=text/javascript src=/plugins/lightgallery/js/lightgallery.js></script>
<script type=text/javascript src=/plugins/lightgallery/js/lg-thumbnail.js></script>
<script type=text/javascript src=/plugins/lightgallery/js/lg-video.js></script>
<script type=text/javascript src=/plugins/lightgallery/js/lg-zoom.js></script>
<script type=text/javascript src=/js/custom.js></script>
<script type=text/javascript src=/js/header_helpers.js></script>
<script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-T5X4T27")</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T5X4T27" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script type=text/javascript>$(document).ready(function(){$("a").off("click").click(function(e){ga("send","event","a",e.type,$(this).attr("id"),1)}),$("[class *= trackClicks_]").off("click").click(function(e){var n=$(this).attr("class").split(/\s+/),t="";$.each(n,function(e,n){n.indexOf("trackClicks_")===0&&(t=n)}),ga("send","event","a",e.type,t,1)})})</script></head><body><header id=top class="header navbar-fixed-top"><div class=container><h1 class="logo pull-left"><a id=header-orangelogo href=/><img id=logo-image class=logo-image src=/images/orange_logo_hq.png alt=Logo></a></h1><nav id=main-nav class="main-nav navbar-right" role=navigation><div class=navbar-header><button class=navbar-toggle type=button data-toggle=collapse data-target=#navbar-collapse>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button></div><div class="navbar-collapse collapse" id=navbar-collapse><ul class="nav navbar-nav"><li class=nav-item><a id=header-screenshots-link href=/screenshots/>Screenshots</a></li><li class=nav-item><a id=header-screenshots-link href=/workflows/>Workflows</a></li><li class=nav-item><a id=header-screenshots-link href=/download/>Download</a></li><li class=nav-item><a id=header-screenshots-link href=/blog/>Blog</a></li><li class=nav-item><a id=header-screenshots-link href=/docs/>Docs</a></li><li class=nav-item><a id=header-screenshots-link href=/training/>Workshops</a></li><li class=nav-search-wrapper><div><a class="btn nav-btn-search btn-warning nav-btn fa fa-search nav-btn-desktop" id=search-btn-js role=button></a><a class="btn nav-btn-search btn-warning nav-btn fa fa-search nav-btn-mobile" role=button href="/search/?q="></a><input type=text class="header-search-input jsonly search-widget-workflow nav-item" id=search-header placeholder=Search tabindex=1 onkeydown=check_key_header(event) hidden autofocus></div></li><li><div class="donate-button transform_header donate_div"><a class="btn btn-warning nav-btn" id=header-donate-link role=button target=_blank href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=A76TAX87ZVR3J">Donate</a></div></li></ul></div></nav></div></header><div id=main><div class="container-fluid clear-top"><div id=overflow-container class=overflow-container><div id=loop-container class="offset-header container"><div class="blog-font-size post type-post status-publish format-standard category-standard category-travel full-without-featured odd excerpt-1 no-image"><div class="entry-meta remove-padding-l-r"><span>Categories:</span>
<span class=category><a href=/blog/addons>addons</a></span>
<span class=category><span>|</span>
<a href=/blog/business-intelligence>business intelligence</a></span>
<span class=category><span>|</span>
<a href=/blog/gsoc2016>gsoc2016</a></span>
<span class=category><span>|</span>
<a href=/blog/orange3>orange3</a></span>
<span class=category><span>|</span>
<a href=/blog/recommender-system>recommender system</a></span></div><div class='entry-header remove-padding-l-r'><h1 class=entry-title>Making recommendations</h1><span class=author-blog>By: SALVACARRION,
Aug 19, 2016</span></div><div class="entry-container remove-padding-l-r"><div class="entry-content md"><article><div id=blog_images_><p><em>This is a guest blog from the Google Summer of Code project.</em></p><p>Recommender systems are everywhere, we can find them on YouTube, Amazon, Netflix, iTunes,&mldr; This is because they are crucial component in a competitive retail services.</p><p>How can I know what you may like if I have almost no information about you? The answer: taking <a href=https://en.wikipedia.org/wiki/Collaborative_filtering>Collaborative filtering (CF)</a> approaches. Basically, this means to combine all the little knowledge we have about users and/or items in order to build a grid of knowledge with which we make recommendation.</p><p>To help you with that, Biolab has written <a href=https://github.com/biolab/orange3-recommendation>Orange3-Recommendation</a> - an add-on for <a href=http://orange.biolab.si/download/>Orange3</a> to train recommendation models, cross-validate them and make predictions.</p><h3 id=heading></h3><h3 id=input-data>Input data</h3><p>First things first. Orange3-Recommendation can read files in native tab-delimited format, or can load data from any of the major standard spreadsheet file type, like CSV and Excel. Native format starts with a header row with feature (column) names. Second header row gives the attribute type, which can be continuous, discrete, string or time. The third header line contains meta information to identify dependent features (class), irrelevant features (ignore) or meta features (meta).</p><p>Here are the first few lines from a data set:</p><pre><code>    tid      user        movie       score
    string   discrete    discrete    continuous
    meta     row=1       col=1       class
    1        Breza       HarrySally  2
    2        Dana        Cvetje      5
    3        Cene        Prometheus  5
    4        Ksenija     HarrySally  4
    5        Albert      Matrix      4
    ...
</code></pre><p><strong>The third row is mandatory in this kind of datasets</strong>*, in order to know which attributes correspond to the users (row=1) and which ones to the items (col=1). For the case of big datasets, users and items must be specified as continuous attributes due to efficiency issues. (*Note: If the meta attributes <em>row</em> or <em>col</em>, some simple heuristics will be applied: users=<em>column 0</em>, items=<em>column 1</em>, class=<em>last column</em>)</p><p>Here are the first few lines from a data set :</p><pre><code>    user            movie         score         tid
    continuous      continuous    continuous    time
    row=1           col=1         class         meta
    196             242           3             881250949
    186             302           3             891717742
    22              377           1             878887116
    244             51            2             880606923
    166             346           1             886397596
    298             474           4             884182806
    ...
</code></pre><h3 id=heading-1></h3><h3 id=training-a-model>Training a model</h3><p>This step is pretty simple. To train a model we have to load the data as is described above and connect it to the learner. (<em>Don&rsquo;t forget to click apply</em>)</p><a href=/images/2016/08/data-to-brismf.png class=blog-image_><img src=/images/2016/08/data-to-brismf.png></a><p>If the model uses side information, we only need to add an extra file.</p><a href=/images/2016/08/TrustSVD-1.png class=blog-image_><img src=/images/2016/08/TrustSVD-1.png></a><p>In addition, we can set the parameters of our model by double-clicking it:</p><a href=/images/2016/08/Screen-Shot-2016-08-22-at-15.49.56.png class=blog-image_><img src=/images/2016/08/Screen-Shot-2016-08-22-at-15.49.56.png></a><p>By using a fixed seed, we make random numbers predictable. Therefore, this feature is useful if we want to compare results in a deterministic way.</p><h3 id=heading-2></h3><h3 id=cross-validation>Cross-validation</h3><p>This is as simple as it seems. The only thing to point out is that side information must be connected to the model.</p><p><img src=/images/2016/08/cv-recommendation.png alt></p><p>Still, cross-validation is a robust way to see how our model is performing. I consider that it&rsquo;s a good idea to check how our model performs with respect to the baseline. This presents a negligible overload* in our pipeline and makes our analysis more solid. <em>(*For 1,000,000 ratings, it can take 0.027s).</em></p><p>We can add a baseline leaner to <a href=/widget-catalog/evaluate/testandscore/>Test&amp;Score</a> and select the model we want to apply.</p><a href=/images/2016/08/Baselines.png class=blog-image_><img src=/images/2016/08/Baselines.png></a><h3 id=making-recommendations>Making recommendations</h3><p>The prediction flow is exactly the same as in <a href=http://orange.biolab.si>Orange3</a>.</p><a href=/images/2016/08/Recommendation-predictions.png class=blog-image_><img src=/images/2016/08/Recommendation-predictions.png></a><h3 id=analyzinglow-rank-matrices>Analyzing low-rank matrices</h3><p><img src=/images/2016/08/all-rank-dis.png alt></p><p>Once we&rsquo;ve output the low-rank matrices, we can play around the vectors in those matrices to discover hidden relations or understand the known ones. For instance, here we plot vector 1 and 2 from the <em>item-feature matrix</em> by simply connecting Data Table with selected instances to the widget <a href=/widget-catalog/visualize/scatterplot/>Scatter Plot</a>.</p><p><img src=/images/2016/08/Visualizing-vectors.png alt></p><p>Using similar approaches we can discover pretty interesting things like similarity between movies or users, how movie genres relate with each other, changes in users&rsquo; behavior, when the popularity of a movie has been raised due to a commercial campaign,&mldr; and many others.</p><p>Finally, a simple pipeline to do all of the above can be something like this:</p><p><img src=/images/2016/08/workflow-recommendation.png alt></p><p>On the left side we connected several models to <a href=/widget-catalog/evaluate/testandscore/>Test&amp;Score</a> in order to cross-validate them. Later, we trained a <a href=http://orange3-recommendation.readthedocs.io/en/latest/widgets/svdplusplus.html>SVD++</a> model, made some predictions, got the low-rank matrices learnt by the model and plotted some vectors of the <em>Item-feature matrix.</em></p><h3 id=analysis-advanced-users>Analysis (Advanced users)</h3><p>Here we&rsquo;ve made a workflow (which can be downloaded <a href=/images/2016/08/Orange3-Workflow-Movielens100k.zip>here</a>) to perform a really basic analysis on the results obtained through factoring the user and item feature matrices with <a href=http://orange3-recommendation.readthedocs.io/en/latest/widgets/brismf.html>BRISMF</a> over the <a href=http://grouplens.org/datasets/movielens/>movielens100k</a> dataset. <em>(Note: Once downloaded, set the prepared datasets in the folder &lsquo;orange&rsquo;. Probably you&rsquo;re gonna get a couple errors. Don&rsquo;t worry, it&rsquo;s normal. To solve it, apply the scripts sequentially but don&rsquo;t forget previously to select all the rows in the related Table.)</em></p><p>Instead of explaining how this pipeline works, the best thing you can do is to download it and play with it.</p><p><img src=/images/2016/08/Complex-flow.png alt></p><p>One of the analysis you can do, is to plot the most popular movies across two first vectors of the matrix descomposition. Later, you can try to find clusters, tweak it a bit and find crossed relations (e.g. <em>male/female</em> Vs._ action/drama)._</p><p><img src=/images/2016/08/Cluster-movies.png alt></p><h3 id=now-lets-focus-on-the-scripting-part>Now let&rsquo;s focus on the scripting part.</h3><h3 id=rating-models>Rating models</h3><p>In this tutorial we are going to train a <a href=http://orange3-recommendation.readthedocs.io/en/latest/scripting/rating.html#brismf>BRISMF</a> model.</p><ol><li><p>First we <strong>import <em>Orange</em> and the learner</strong> that we want to use:</p><pre><code> import Orange
 from orangecontrib.recommendation import BRISMFLearner
</code></pre></li><li><p>After that, we have to <strong>load a dataset</strong>:</p><pre><code> data = Orange.data.Table('movielens100k.tab')
</code></pre></li><li><p>Then we set the <strong>learner parameters</strong>, and finally we <strong>train it</strong> passing the dataset as an argument (the returned value will be our model trained):</p><pre><code> learner = BRISMFLearner(num_factors=15, num_iter=25, learning_rate=0.07, lmbda=0.1)
 recommender = learner(data)
</code></pre></li><li><p>Finally, we can <strong>make predictions</strong> (in this case, for the first three pairs in the dataset):</p><pre><code> prediction = recommender(data[:3])
 print(prediction)
 &gt;&gt;&gt; [ 3.79505151 3.75096513 1.293013 ]
</code></pre></li></ol><h3 id=heading-3></h3><h3 id=rankingmodels>Ranking models</h3><p>At this point we can try something new, let&rsquo;s make recommendations for a dataset in which only binary relevance is available. For this case, <a href=http://orange3-recommendation.readthedocs.io/en/latest/scripting/ranking.html>CLiMF</a> is model that will suit our needs.</p><pre><code>import Orange
import numpy as np
from orangecontrib.recommendation import CLiMFLearner

# Load data
data = Orange.data.Table('epinions_train.tab')

# Train recommender
learner = CLiMFLearner(num_factors=10, num_iter=10, learning_rate=0.0001, lmbda=0.001)
recommender = learner(data)

# Make recommendations
recommender(X=5)
&gt;&gt;&gt; [ 494,   803,   180, ..., 25520, 25507, 30815]
</code></pre><p>Later, we can score the model. In this case we&rsquo;re using the <em>MeanReciprocalRank:</em></p><pre><code>import Orange

# Load test
dataset testdata = Orange.data.Table('epinions_test.tab') 

# Sample users 
num_users = len(recommender.U)
num_samples = min(num_users, 1000) # max. number to sample
users_sampled = np.random.choice(np.arange(num_users), num_samples) 

# Compute Mean Reciprocal Rank (MRR) 
mrr, _ = recommender.compute_mrr(data=testdata, users=users_sampled) 
print('MRR: %.4f' % mrr) 
&gt;&gt;&gt; MRR: 0.3975
</code></pre><h3 id=heading-4></h3><h3 id=sgd-optimizers>SGD optimizers</h3><p>This add-on includes several configurations that can be used to modify the updates on the low rank matrices during the stochastic gradient descent optimization.</p><ul><li><a href=http://orange3-recommendation.readthedocs.io/en/latest/scripting/optimizers.html#stochastic-gradient-descent>SGD</a>: Classical SGD update.</li><li><a href=http://orange3-recommendation.readthedocs.io/en/latest/scripting/optimizers.html#momentum>Momentum</a>: SGD with inertia.</li><li><a href=http://orange3-recommendation.readthedocs.io/en/latest/scripting/optimizers.html#nesterov-s-accelerated-gradient>Nesterov momentum</a>: A Momentum that &ldquo;looks ahead&rdquo;.</li><li><a href=http://orange3-recommendation.readthedocs.io/en/latest/scripting/optimizers.html#adagradient>AdaGrad</a>: Optimizer that adapts its learning rating during the process.</li><li><a href=http://orange3-recommendation.readthedocs.io/en/latest/scripting/optimizers.html#rmsprop>RMSProp</a>: &ldquo;Leaky&rdquo; AdaGrad.</li><li><a href=http://orange3-recommendation.readthedocs.io/en/latest/scripting/optimizers.html#adadelta>AdaDelta</a>: Extension of Adagrad that seeks to reduce its aggressive.</li><li><a href=http://orange3-recommendation.readthedocs.io/en/latest/scripting/optimizers.html#adam>Adam</a>: Similar to AdaGrad and RMSProp but with an exponentially decaying average of past gradients.</li><li><a href=http://orange3-recommendation.readthedocs.io/en/latest/scripting/optimizers.html#adamax>Adamax</a>: Similar to Adam, but taking the maximum between the gradient and the velocity.</li></ul><p>Do you want to learn more about this? Check our <a href=http://orange3-recommendation.readthedocs.io>documentation</a>!</p></div></article></div></div></div></div></div><div id=disqus_thread></div><script>(function(){var e=document,t=e.createElement("script");t.src="https://orange-4.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><script type=text/javascript>$(document).ready(function(){$("#blog_images_").lightGallery({thumbnail:!1,selector:"a:has(img)",width:"60%",mode:"lg-fade",counter:!1,download:!1,enableSwipe:!1,enableDrag:!1,speed:1,useLeft:!0,hideBarsDelay:1e3})})</script></div></div><footer class=footer><div class=container><div class=row><div class="col-md-4 col-sm-6 col-xs-12"><div class=row><div class="col-sm-4 sitemap-group"><ul class="links list-sitemap"><li><b><div class=sitemap-cat>Orange</div></b></li><li><a class=sitemap-sub href=/faq/>FAQ</a></li><li><a class=sitemap-sub href=/license/>License</a></li><li><a class=sitemap-sub href=/privacy/>Privacy</a></li><li><a class=sitemap-sub href=/citation/>Citation</a></li><li><a class=sitemap-sub href=/contact/>Contact</a></li></ul></div><div class="col-sm-4 sitemap-group"><ul class="links list-sitemap"><li><div class=sitemap-cat>Download</div></li><li><a class=sitemap-sub href=/download/#windows>Windows</a></li><li><a class=sitemap-sub href=/download/#macos>Mac OS</a></li></ul></div><div class="col-sm-4 sitemap-group"><ul class="links list-sitemap"><li><b><div class=sitemap-cat>Community</div></b></li><li><a class=sitemap-sub href=https://www.facebook.com/orangedatamining target=_blank>Facebook</a></li><li><a class=sitemap-sub href=https://www.youtube.com/channel/UClKKWBe2SCAEyv7ZNGhIe4g target=_blank>YouTube</a></li><li><a class=sitemap-sub href=https://twitter.com/orangedataminer target=_blank>Twitter</a></li><li><a class=sitemap-sub href=https://datascience.stackexchange.com/questions/tagged/orange target=_blank>Stack Exchange</a></li><li><a class=sitemap-sub href=https://discord.gg/FWrfeXV target=_blank>Discord</a></li></ul></div></div></div><div class="col-md-3 col-sm-6 col-xs-12"><div class=row><div class="col-sm-5 col-md-7 col-lg-6 sitemap-group docs-devs"><ul class="links list-sitemap"><li><div class=sitemap-cat>Documentation</div></li><li><a class=sitemap-sub href=/getting-started/>Get started</a></li><li><a class=sitemap-sub href=/widget-catalog/>Widgets</a></li><li><a class=sitemap-sub href=http://docs.biolab.si/3/data-mining-library/>Scripting</a></li></ul></div><div class="col-sm-3 sitemap-group"><ul class="links list-sitemap"><li><b><div class=sitemap-cat>Developers</div></b></li><li><a class=sitemap-sub target=_blank href=https://github.com/biolab/orange3>GitHub</a></li><li><a class=sitemap-sub target=_blank href=http://docs.biolab.si/3/development/>Getting Started</a></li></ul></div></div></div><div class="col-md-5 col-sm-12 col-xs-12 sitemap-group"><div class=latest-blog-posts><ul class="links list-sitemap" style=padding-bottom:10px><li><b><a class=sitemap-cat href=/blog/>Latest blog posts</a></b></li><li><div class=row><div class=col-md-2><a class=sitemap-sub>19 Sep</a></div><div class=col-md-10><a class=sitemap-sub style=color:#f79211 href=/blog/2023/2023-09-19-fairness-reweighing-dataset/>Orange Fairness - Reweighing a Dataset</a></div></div></li><li><div class=row><div class=col-md-2><a class=sitemap-sub>18 Sep</a></div><div class=col-md-10><a class=sitemap-sub style=color:#f79211 href=/blog/2023/2023-09-18-fairness-dataset-bias/>Orange Fairness - Dataset Bias</a></div></div></li><li><div class=row><div class=col-md-2><a class=sitemap-sub>31 Aug</a></div><div class=col-md-10><a class=sitemap-sub style=color:#f79211 href=/blog/2023/2023-08-31-a-dash-of-dask/>A dash of Dask</a></div></div></li></ul></div></div></div><div class="row footer-pad"><div class=col-xs-12><small class="copyright pull-left">Copyright © University of Ljubljana</small></div></div></div></footer></body></html>