<html>    
    <head>
    <title>Orange Data Mining - How to Abuse p-Values in Correlations</title>

    
    
    <meta property="og:title" content="How to Abuse p-Values in Correlations">
    
    
    <meta property="og:description" content="Why doesn&#39;t Orange show p-values for correlations coefficients? To save you from data dredging and Texas sharpshooter fallacy...">
    
    
    <meta property="og:image" content="/blog_img/2019/1/4/correlations.png">
    

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Orange Data Mining Toolbox">
    <meta name="author" content="Bioinformatics Laboratory, University of Ljubljana">
    <meta name="google-site-verification" content="DS7GH5M7ABi78pIC2rMcTBFx-UeBFObXOeLvR7Ow3EQ" />
    <link rel="shortcut icon" href="/images/favicon.ico">
    
    <link href='https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Covered+By+Your+Grace' rel='stylesheet' type='text/css'>
    
    <link rel="stylesheet" href="/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/plugins/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" href="/plugins/lightgallery/css/lightgallery.css">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="/build/css/styles.min.css">
    <script id="dsq-count-scr" src="//orange-4.disqus.com/count.js" async></script>

     <script src="https://www.recaptcha.net/recaptcha/api.js" async defer></script>
    <noscript>
        <style>
            .jsonly { display: none !important; }
        </style>
    </noscript>
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-528382-1', 'auto');
      ga('require', 'linkid');
      ga('send', 'pageview');


    </script>

    
 

    <script type="text/javascript" src="/plugins/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="/plugins/jquery.form.js"></script> 
    <script type="text/javascript" src="/plugins/bootstrap/js/bootstrap.min.js"></script>
    
    <script type="text/javascript" src="/plugins/lightgallery/js/lightgallery.js"></script>
    <script type="text/javascript" src="/plugins/lightgallery/js/lg-thumbnail.js"></script>
    <script type="text/javascript" src="/plugins/lightgallery/js/lg-video.js"></script>
    <script type="text/javascript" src="/plugins/lightgallery/js/lg-zoom.js"></script>
    <script type="text/javascript" src="/js/custom.js"></script>

    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T5X4T27');</script>
    

    
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T5X4T27"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    

    
    <script type="text/javascript">
      $( document ).ready( function () {

        $('a').off("click").click( function ( event ) {
           ga('send', 'event', "a", event.type, $(this).attr("id"), 1 );
        });

        $('[class *= trackClicks_]').off("click").click( function ( event ) {
           var classList = $(this).attr('class').split(/\s+/);
           var trackname = "";
           $.each(classList, function(index, item) {
             if (item.indexOf('trackClicks_') === 0) {
                trackname = item;
             }
           });
           ga('send', 'event', "a", event.type, trackname, 1 );
        });
      });
    </script>

</head>
    <body>

     <header id="top" class="header navbar-fixed-top">
        <div class="container" >
            <h1 class="logo pull-left" >
                <a id="header-orangelogo" href="/">
                    <img id="logo-image" class="logo-image" src="/images/orange_logo_hq.png" alt="Logo">
                </a>
            </h1>
            <nav id="main-nav" class="main-nav navbar-right" role="navigation">
                <div class="navbar-header">
                    <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
               <div class="navbar-collapse collapse" id="navbar-collapse">
                    <ul class="nav navbar-nav">

                        
                        
                            
                            <li class="nav-item"><a id="header-screenshots-link"  href="/screenshots/">Screenshots</a></li>
                            
                        
                    
                    
                        
                            
                            <li class="nav-item"><a id="header-screenshots-link"  href="/workflows/">Workflows</a></li>
                            
                        
                    
                    
                        
                            
                            <li class="nav-item"><a id="header-screenshots-link"  href="/download/">Download</a></li>
                            
                        
                    
                    
                        
                            
                            <li class="nav-item"><a id="header-screenshots-link"  href="/blog/">Blog</a></li>
                            
                        
                    
                    
                        
                            
                            <li class="nav-item"><a id="header-screenshots-link"  href="/docs/">Docs</a></li>
                            
                        
                    
                    
                        
                            
                            <li class="nav-item"><a id="header-screenshots-link"  href="/training/">Workshops</a></li>
                            
                        
                    
                    
                        
                            
                        <li class="">
                            <a class="btn btn-warning big-button-base donate" id="header-donate-link" role="button" target="_blank" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=A76TAX87ZVR3J">Donate</a>
                        </li>
                            
                        
                    
                    
                    </ul>
                </div>
            </nav>
        </div>
    </header>

    <div id="main">
        <div class="container-fluid clear-top">
            
<div id="overflow-container" class="overflow-container">
  <div id="loop-container" class="offset-header container">
    
      <div
        class="blog-font-size post type-post status-publish format-standard category-standard category-travel full-without-featured odd excerpt-1 no-image">
        
        <div class="entry-meta remove-padding-l-r">
          <span>Categories: </span>
          
        </div>
        <div class='entry-header remove-padding-l-r'>
          <h1 class='entry-title'> How to Abuse p-Values in Correlations</h1>
          <span class="author-blog">
            
            By: Ajda Pretnar,
            
            Jan 4, 2019
          </span>
        </div>
        <div class="entry-container remove-padding-l-r">
          <div class="entry-content md">
            <article>
              <div id="blog_images_">


              <p>In a parallel universe, not so far from ours, Orange’s Correlation widget looks like this.</p>
<p>\</p>
<a href="/blog_img/2019/1/4/correlations-p-values-1.png" class="blog-image_"> 
      <img src="/blog_img/2019/1/4/correlations-p-values-1.png" />
 </a>
<p><br>
\</p>
<p>Quite similar to ours, except that this one shows p-values instead of correlation coefficients. Which is actually better, isn’t it? I mean, we have all attended Statistics 101, and we know that you can never trust correlation coefficients without looking at p-values to check that these correlations are real, right? So why on Earth doesn’t Orange show them?</p>
<p>First a side note. It was Christmas not long ago. Let’s call a ceasefire on the frequentist vs. Bayesian war. Let us, for Christ’s sake, pretend, pardon, agree that null-hypothesis testing is not wrong per se.</p>
<p>The mantra of null-hypothesis significance testing goes like this:</p>
<ol>
<li>Form hypothesis.</li>
<li>Collect data.</li>
<li>Test hypothesis.</li>
</ol>
<p>In contrast, the parallel-universe Correlation widget is (ab)used like this:</p>
<ol>
<li>Collect data.</li>
<li>Test all possible hypotheses.</li>
<li>Cherry pick those that are confirmed.</li>
</ol>
<p>This is like the <a href="https://en.wikipedia.org/wiki/Texas_sharpshooter_fallacy" target="_blank">Texas sharpshooter</a> who fires first and then draws targets around the shots. You should never formulate hypothesis based on some data and then use this same data to prove it. Because it usually (surprise!) works.</p>
<p>\</p>
<a href="/blog_img/2019/1/4/TexasSharpShooter.png" class="blog-image_"> 
      <img src="/blog_img/2019/1/4/TexasSharpShooter.png" />
 </a>
<p><br>
\</p>
<p>Back to the above snapshot. It shows correlations between 100 vegetables based on 100 different measurements (Ca and Mg content, their consumption in Finland, number of mentions in Star Trek DS9 series, likelihood of finding it on the Mars, and so forth). In other words, it’s all made it up. Just a 100×100 matrix of random numbers with column labels from the simple Wikipedia <a href="https://simple.wikipedia.org/wiki/List_of_vegetables" target="_blank">list of vegetables</a>. Yet the similarity between <a href="https://en.wikipedia.org/wiki/Mung_bean" target="_blank">mung bean</a> and <a href="https://en.wikipedia.org/wiki/Jerusalem_artichoke" target="_blank">sunchokes</a> surely cannot be dismissed (p &lt; 0.001). Those who like bell pepper should try cilantro, too, because it’s basically one and the same thing (p = 0.001). And I honestly can’t tell black bean from wasabi (p = 0.001).</p>
<p>Here are the p-values for the top 100 most correlated pairs.</p>
<pre><code>import numpy as np
import scipy as sp
a = np.random.random((100, 100))
sorted(stats.pearsonr(a[i], a[j])[1] for i in range(100) for j in range(i))[:100]
[0.0002774329730584203, 0.0004158786523819104, 0.0005008536192579852,
0.0007211022164265075, 0.0008268675086438253, 0.0010265740674904762,
(...91 values omitted to reduce the nonsense)
0.01844720610938738, 0.018465602922746942, 0.018662079618069056]
First 100 correlations are highly significant.
</code></pre>
<p>To learn a lesson we may have failed to grasp at the NHST 101 class, consider that there are 100 * 99 / 2 pairs. What is the significance of the pair at 5-th percentile?</p>
<pre><code>correlations = sorted(stats.pearsonr(a[i], a[j])[1] for i in range(100) for j in range(i))
npairs = 100 * 99 / 2
print(correlations[int(pairs * 0.05)]
0.0496868751692227
</code></pre>
<p>Roughly 0.05. This is exactly what should have happened, because:</p>
<pre><code>correlations[int(npairs * 0.10)]
0.10004180592217532
correlations[int(npairs * 0.15)]
0.15236602574520097
correlations[int(npairs * 0.30)]
0.3026816170584785
</code></pre>
<p>This proves only that p-values for the Pearson correlation coefficient are well calibrated (and that <a href="https://en.wikipedia.org/wiki/Mersenne_Twister" target="_blank">Mersenne twister</a> that is used to generate random numbers in numpy works well). In theory, the p-value for a certain statistics (like Pearson’s r) is the probability of getting such or even more extreme value if the null-hypothesis (of no correlation, in our case) is actually true. 5 % of random hypotheses should have a p-value below 0.05, 10 % a value below 10, and 23 % a value below 23.</p>
<p>Imagine what they can do with the Correlations widget in the parallel universe! They compute correlations between all pairs, print out the first 5 % of them and start writing a paper without bothering to look at p-values at all. They know they should be statistically significant even if the data is random.</p>
<p>Which is precisely the reason why our widget must not compute p-values: because people would use it for Texas sharpshooting. P-values make sense only in the context of the proper NHST procedure (still pretending for the sake of Christmas ceasefire). They cannot be computed using the data on which they were found.</p>
<p>If so, why do we have the Correlation widget at all if it’s results are unpublishable? We can use it to find highly correlated pairs in a data sample. But we can’t just attach p-values to them and publish them. By finding these pairs (with assistance of Correlation widget) we just formulate hypotheses. This is only step 1 of the enshrined NHST procedure. We can’t skip the other two: the next step is to collect some new data (existing data won’t do!) and then use it to test the hypotheses (step 3).</p>
<p>Following this procedure doesn’t save us from <a href="https://en.wikipedia.org/wiki/Data_dredging" target="_blank">data dredging</a>. There are still plenty of ways to cheat. It is the most tempting to select the first 100 most correlated pairs (or, actually, any 100 pairs), (re)compute correlations on some new data and publish the top 5 % of these pairs. The official solution for this is a patchwork of various corrections for multiple hypotheses testing, but… Well, they don’t work, but we should say no more here. You know, Christmas ceasefire.</p>

            </div>
            </article>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="disqus_thread"></div>
<script>





(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://orange-4.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
</div>
<script type="text/javascript">
    $(document).ready(function() {
        $('#blog_images_').lightGallery({
        thumbnail: false,
        selector: 'a:has(img)',
        width: '60%',
        mode: 'lg-fade',
        counter: false,
        download: false,
        enableSwipe: false,
        enableDrag: false,
        speed: 1,
        useLeft: true,
        hideBarsDelay: 1000
    });
    });
</script>

        </div>
    </div>
    <footer class="footer">
        <div class="container">
            <div class="row">

                <div class="col-md-4 col-sm-6 col-xs-12">
                    <div class="row">

                        <div class="col-sm-4 sitemap-group">
                            <ul class="links list-sitemap">
                                <li><b><div class="sitemap-cat">Orange</div></b></li>
                                <li><a class="sitemap-sub" href="/faq/">FAQ</a></li>
                                <li><a class="sitemap-sub" href="/license/">License</a></li>
                                <li><a class="sitemap-sub" href="/privacy/">Privacy</a></li>
                                <li><a class="sitemap-sub" href="/citation/">Citation</a></li>
                                <li><a class="sitemap-sub" href="/contact/">Contact</a></li>
                            </ul>
                        </div>

                        <div class="col-sm-4 sitemap-group">
                            <ul class="links list-sitemap">
                                <li><div class="sitemap-cat">Download</div></li>
                                <li><a class="sitemap-sub" href="/download/#windows">Windows</a></li>
                                <li><a class="sitemap-sub" href="/download/#macos">Mac OS</a></li>
                                
                            </ul>
                        </div>

                        <div class="col-sm-4 sitemap-group">

                            <ul class="links list-sitemap">
                                <li><b><div class="sitemap-cat">Community</div></b></li>
                                <li><a class="sitemap-sub" href="https://www.facebook.com/orangedm" target="_blank">Facebook</a></li>
                                <li><a class="sitemap-sub" href="https://www.youtube.com/channel/UClKKWBe2SCAEyv7ZNGhIe4g" target="_blank">YouTube</a></li>
                                <li><a class="sitemap-sub" href="https://twitter.com/orangedataminer" target="_blank">Twitter</a></li>
                                <li><a class="sitemap-sub" href="https://datascience.stackexchange.com/questions/tagged/orange" target="_blank">Stack Exchange</a></li>
                                <li><a class="sitemap-sub" href="https://discord.gg/FWrfeXV" target="_blank">Discord</a></li>
                            </ul>

                        </div>

                    </div>
                </div>

                <div class="col-md-3 col-sm-6 col-xs-12">
                    <div class="row">

                        <div class="col-sm-5 col-md-7 col-lg-6 sitemap-group docs-devs">
                            <ul class="links list-sitemap">
                                <li><div class="sitemap-cat">Documentation</div></li>
                                <li><a class="sitemap-sub" href='/getting-started/'>Get started</a></li>
                                <li><a class="sitemap-sub" href="/widget-catalog/">Widgets</a></li>
                                <li><a class="sitemap-sub" href="http://docs.biolab.si/3/data-mining-library/">Scripting</a></li>
                            </ul>
                        </div>

                        <div class="col-sm-3 sitemap-group">
                            <ul class="links list-sitemap">
                                <li><b><div class="sitemap-cat">Developers</div></b></li>
                                <li><a class="sitemap-sub" target="_blank" href="https://github.com/biolab/orange3">GitHub</a></li>
                            </ul>
                        </div>

                    </div>
                </div>

                <div class="col-md-5 col-sm-12 col-xs-12 sitemap-group">
                    <div class="latest-blog-posts">
                        <ul class="links list-sitemap" style="padding-bottom: 10px">
                            <li><b><a class="sitemap-cat" href="/blog/">Latest blog posts</a></b></li>
                            
                            <li>
                            <div class="row">
                            <div class="col-md-2"><a class="sitemap-sub"> 11 Jan </a></div>
                            <div class="col-md-10">
                                <a class="sitemap-sub" style="color: #f79211" href="/blog/2021/2021-01-11-orange-in-classroom/">Orange in Classroom</a>
                            </div>
                            </div>
                            </li>
                            
                            <li>
                            <div class="row">
                            <div class="col-md-2"><a class="sitemap-sub"> 21 Dec </a></div>
                            <div class="col-md-10">
                                <a class="sitemap-sub" style="color: #f79211" href="/blog/2020/2020-12-21-year-in-code/">2020 - Year in Code</a>
                            </div>
                            </div>
                            </li>
                            
                            <li>
                            <div class="row">
                            <div class="col-md-2"><a class="sitemap-sub"> 15 Oct </a></div>
                            <div class="col-md-10">
                                <a class="sitemap-sub" style="color: #f79211" href="/blog/2020/2020-10-15-document-embedders/">How to identify fake news with document embeddings</a>
                            </div>
                            </div>
                            </li>
                            
                        </ul>
                    </div>
                </div>

            </div>

            <div class="row footer-pad">
                <div class="col-xs-12">
                    <small class="copyright pull-left"  >Copyright © University of Ljubljana</small>
                </div>
            </div>
        </div>
    </footer>

    </body>
</html>