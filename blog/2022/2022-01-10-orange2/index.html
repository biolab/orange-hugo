<html>    
    <head>
    <title>Orange Data Mining - Compiling Orange 2 on modern Linux</title>

    
    
    <meta property="og:title" content="Compiling Orange 2 on modern Linux">
    
    
    <meta property="og:description" content="How to compile an ancient version of Orange on Ubuntu 20.04 or how to spend a cold winter evening.">
    
    
    <meta property="og:image" content="/blog_img/2022/2022-01-10-orange2-about.png">
    

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Orange Data Mining Toolbox">
    <meta name="author" content="Bioinformatics Laboratory, University of Ljubljana">
    <meta name="google-site-verification" content="DS7GH5M7ABi78pIC2rMcTBFx-UeBFObXOeLvR7Ow3EQ" />
    <link rel="shortcut icon" href="/images/favicon.ico">
    
    <link href='https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Covered+By+Your+Grace' rel='stylesheet' type='text/css'>
    
    <link rel="stylesheet" href="/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/plugins/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" href="/plugins/lightgallery/css/lightgallery.css">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    
    
    
    <link rel="stylesheet" href="/scss/main.58e8531e166454b3665e4c7132aa2f1762a5569c179efa4bbf56b266ce93bfac.css">
    <script id="dsq-count-scr" src="//orange-4.disqus.com/count.js" async></script>

    <noscript>
        <style>
            .jsonly { display: none !important; }
        </style>
    </noscript>
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-528382-1', 'auto');
      ga('require', 'linkid');
      ga('send', 'pageview');


    </script>




    <script type="text/javascript" src="/plugins/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="/plugins/jquery.form.js"></script>
    <script type="text/javascript" src="/plugins/bootstrap/js/bootstrap.min.js"></script>
    
    <script type="text/javascript" src="/plugins/lightgallery/js/lightgallery.js"></script>
    <script type="text/javascript" src="/plugins/lightgallery/js/lg-thumbnail.js"></script>
    <script type="text/javascript" src="/plugins/lightgallery/js/lg-video.js"></script>
    <script type="text/javascript" src="/plugins/lightgallery/js/lg-zoom.js"></script>
    <script type="text/javascript" src="/js/custom.js"></script>
    <script type="text/javascript" src="/js/header_helpers.js"></script>


    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T5X4T27');</script>
    

    
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T5X4T27"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    

    
    <script type="text/javascript">
      $( document ).ready( function () {

        $('a').off("click").click( function ( event ) {
           ga('send', 'event', "a", event.type, $(this).attr("id"), 1 );
        });

        $('[class *= trackClicks_]').off("click").click( function ( event ) {
           var classList = $(this).attr('class').split(/\s+/);
           var trackname = "";
           $.each(classList, function(index, item) {
             if (item.indexOf('trackClicks_') === 0) {
                trackname = item;
             }
           });
           ga('send', 'event', "a", event.type, trackname, 1 );
        });
      });
    </script>

</head>

    <body>

    <header id="top" class="header navbar-fixed-top">
  <div class="container" >
      <h1 class="logo pull-left" >
          <a id="header-orangelogo" href="/">
              <img id="logo-image" class="logo-image" src="/images/orange_logo_hq.png" alt="Logo">
          </a>
      </h1>
      <nav id="main-nav" class="main-nav navbar-right" role="navigation">
          <div class="navbar-header">
              <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-collapse">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
              </button>
          </div>
         <div class="navbar-collapse collapse" id="navbar-collapse">
              <ul class="nav navbar-nav">

                  

                  
                  
                      
                      <li class="nav-item"><a id="header-screenshots-link"  href="/screenshots/">Screenshots</a></li>
                      
                  
                
              

                  
                  
                      
                      <li class="nav-item"><a id="header-screenshots-link"  href="/workflows/">Workflows</a></li>
                      
                  
                
              

                  
                  
                      
                      <li class="nav-item"><a id="header-screenshots-link"  href="/download/">Download</a></li>
                      
                  
                
              

                  
                  
                      
                      <li class="nav-item"><a id="header-screenshots-link"  href="/blog/">Blog</a></li>
                      
                  
                
              

                  
                  
                      
                      <li class="nav-item"><a id="header-screenshots-link"  href="/docs/">Docs</a></li>
                      
                  
                
              

                  
                  
                      
                      <li class="nav-item"><a id="header-screenshots-link"  href="/training/">Workshops</a></li>
                      
                  
                
              

                  
                      <li class="nav-search-wrapper">
                        <div>                         
                          
                          <a class="btn nav-btn-search btn-warning nav-btn fa fa-search nav-btn-desktop" 
                            id="search-btn-js" 
                            role="button">
                          </a>
                          
                          
                          <a class="btn nav-btn-search btn-warning nav-btn fa fa-search nav-btn-mobile" 
                            role="button" 
                            href="/search/?q=">
                          </a>

                          <input type="text" 
                                class="header-search-input jsonly search-widget-workflow nav-item" 
                                id="search-header" 
                                placeholder="Search" 
                                tabindex="1" 
                                onkeydown="check_key_header(event)" 
                                hidden
                                autofocus />
                        </div>
                      </li>
                  
              

                  
                  
                      
                  <li class="">
                    <div class="donate-button transform_header donate_div">
                      <a class="btn btn-warning nav-btn" id="header-donate-link" role="button" target="_blank" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=A76TAX87ZVR3J">Donate</a>
                    </div>
                  </li>
                      
                  
                
              
              </ul>
          </div>
      </nav>
  </div>
</header>

    <div id="main">
        <div class="container-fluid clear-top">
            
<div id="overflow-container" class="overflow-container">
  <div id="loop-container" class="offset-header container">
    
      <div
        class="blog-font-size post type-post status-publish format-standard category-standard category-travel full-without-featured odd excerpt-1 no-image">
        
        <div class="entry-meta remove-padding-l-r">
          <span>Categories: </span>
          
          <span class="category">
            
            <a href="/blog/python">python</a>
          </span>
          
          <span class="category">
            
            <span> | </span>
            
            <a href="/blog/development">development</a>
          </span>
          
          <span class="category">
            
            <span> | </span>
            
            <a href="/blog/linux">linux</a>
          </span>
          
        </div>
        <div class='entry-header remove-padding-l-r'>
          <h1 class='entry-title'> Compiling Orange 2 on modern Linux</h1>
          <span class="author-blog">
            
            By: Marko Toplak,
            
            Jan 10, 2022
          </span>
        </div>
        <div class="entry-container remove-padding-l-r">
          <div class="entry-content md">
            <article>
              <div id="blog_images_">


              <p>We abandoned Orange 2 in 2015 because we did not have enough resources to split between maintaining Orange 2 and building the new version from scratch. Orange was due for a rewrite for quite some time. The core of the pre-3 Orange was written mainly in C++. When Orange was conceived, extending Python with C was the only option to make it run fast enough. Orange was designed before NumPy and even before NumPy&rsquo;s predecessors, Numarray and Numeric. The resulting code was hard to maintain. In the meantime, Python libraries such as NumPy and scikit-learn matured, so the rewrite seemed reasonable: Orange 3 was born.</p>
<p>Currently, we need Orange 2 as a reference implementation for interaction analysis, something that Orange 3 still lacks. Two features positively interact if observing the features in combination yields more information than the sum of information of observing both features separately. The Interaction Graph widget from Orange 2, which uses the <a href="http://stat.columbia.edu/~jakulin/Int/">interaction gain measure</a>, is a great tool to discover such interacting features.</p>
<p>As a Linux user, I admire the backward compatibility we learned to expect on Windows: if an application ever did work there, it probably still does. On Windows, an old Orange 2 build from <a href="https://download.biolab.si/download/files/">the download archive</a> probably still works. In contrast, old Mac OS Orange packages are likely problematic because recent Mac OS versions stopped supporting 32-bit binaries.</p>
<p>Linux/GNU users do not have the luxury of installing old binary Orange packages. They do not exist because building them presented a lot of work that would benefit a few users. Even if they had, they would be hard to run; while the Linux kernel is highly backward compatible, its userspace is not.</p>
<p>Therefore, we need to dig into the code, starting with a checkout of Orange 2 code for the git repository:</p>
<pre tabindex="0"><code>git clone git@github.com:biolab/orange2.git
cd orange2
</code></pre><p>The source code includes the INSTALL.txt, which suggests installing a bunch of Python libraries with the Linux distribution&rsquo;s package manager and then compiling Orange. Now, the problems start. The instructions say they were tested with Ubuntu 14.04, which is not more than seven years old. Curiously, a quick <code>git blame</code> confirms that I was the author of the instructions, so Ubuntu 14.04 seems to be the latest distribution I have ever used to install Orange 2.</p>
<p>Here the problems begin. The required libraries no longer exist as packages in Ubuntu 20.04 that I am using, and neither does Python 2. Fortunately, Anaconda comes to the rescue. We can use it to create a new Python 2 environment:</p>
<pre tabindex="0"><code>conda create --name py2 -c defaults --override-channels python=2.7
conda activate py2
</code></pre><p>Then, we can install the needed libraries with <code>conda</code>. I found the list of required packages in the <code>setup.py</code> file.</p>
<pre tabindex="0"><code>conda install -c defaults --override-channels numpy scipy setuptools
conda install -c conda-forge --override-channels pyqt=4.11
</code></pre><p>I needed quite some time to figure out which combination of packages and sources is installable. We can now try to do a development installation of Orange:</p>
<pre tabindex="0"><code>python setup.py develop
</code></pre><p>That fails:</p>
<pre tabindex="0"><code>source/include/stat.hpp:33:27: error: 'double abs(double)' conflicts with a previous declaration
</code></pre><p>Such problems are expected when we compile old code with a newer compiler or libraries. I tried installing older compiler versions, but my distribution only went back to GCC-7, which was already too new. So I had to fix the code. The following change fixed the error:</p>
<pre tabindex="0"><code>--- a/source/include/stat.hpp
+++ b/source/include/stat.hpp
@@ -30,8 +30,8 @@ using namespace std;
 #endif
 
 #ifndef _MSC_VER_70
-inline double abs(double x)
-{ return fabs(x); }
+//inline double abs(double x)
+//{ return fabs(x); }
 #endif
</code></pre><p>There were other errors with return types of C++ functions called from Python. After about <a href="/blog_img/2022/2022-01-10-orange2-0001.patch">10 changed lines</a> and quite some waiting, Orange was finally installed! The compilation took 10 minutes on my newish laptop. So a lot of code had to be compiled. And someone had to write it! Amazingly, most of the C++ code of Orange 2 was written by a single developer, Janez Demšar.</p>
<p>Well, now Orange is installed, but does it work? Let&rsquo;s try to run it:</p>
<pre tabindex="0"><code>orange-canvas
</code></pre><p>Nope, not quite:</p>
<pre tabindex="0"><code>  ...
  File &quot;/home/marko/dev/orange2/Orange/OrangeCanvas/main.py&quot;, line 23, in &lt;module&gt;
    from Orange.OrangeCanvas.application.canvasmain import CanvasMainWindow
  File &quot;/home/marko/dev/orange2/Orange/OrangeCanvas/application/canvasmain.py&quot;, line 28, in &lt;module&gt;
    from PyQt4.QtWebKit import QWebView
ImportError: libQtWebKit.so.4: cannot open shared object file: No such file or directory
</code></pre><p>It seems that the installed Qt package lacks WebKit. I could not find any prebuilt Qt4 with it, and I really did not want to go into compiling Qt and PyQt myself! Remembering that the web interface is mostly used in two places in Orange, help and reports, I tried making WebKit import and its usage optional: see changes to <a href="/blog_img/2022/2022-01-10-orange2-0002.patch">canvasmain.py</a>.</p>
<p>Now, <code>orange-canvas</code> finally opened. But where are the widgets? All widget categories are empty:</p>
<a href="/blog_img/2022/2022-01-10-orange2-without-widgets.png" class="blog-image_"> 
      <img src="/blog_img/2022/2022-01-10-orange2-without-widgets.png" class="window-screenshot" />
 </a>


<p>To find out why, we need to run with debugging output:</p>
<pre tabindex="0"><code>orange-canvas -l4 --force-discovery
</code></pre><p>We see new exceptions, namely the repeated problems when widgets try to import the reporting functionality:</p>
<pre tabindex="0"><code>  ...
  File &quot;/home/marko/dev/orange2/Orange/OrangeWidgets/OWWidget.py&quot;, line 319, in &lt;module&gt;
    import OWReport
  File &quot;/home/marko/dev/orange2/Orange/OrangeWidgets/OWReport.py&quot;, line 34, in &lt;module&gt;
    from PyQt4.QtWebKit import *
ImportError: libQtWebKit.so.4: cannot open shared object file: No such file or directory
</code></pre><p>By making reports optional with changes to <a href="/blog_img/2022/2022-01-10-orange2-0003.patch">OWReport.py</a>, some widgets finally appear. Among them, we are lucky to find File and Interaction Graph widgets, precisely the ones we need. For the Interaction Graph to work properly, I also needed to install <code>graphviz</code>:</p>
<pre tabindex="0"><code>sudo apt install graphviz
</code></pre><p>The widgets that still fail to work are mainly visualizations. And for a good reason: Orange 2 visualizations were based on pyqwt5, a library that was already abandoned and hard to install even when Orange 2 was still being actively developed. I did not find any conda-installable packages of pyqwt5, and my first attempts at installing it from the source code failed.</p>
<p>Therefore, I stop. I already have all the parts I need. Now, on to interactions analysis!</p>
<a href="/blog_img/2022/2022-01-10-orange2-interactions.png" class="blog-image_"> 
      <img src="/blog_img/2022/2022-01-10-orange2-interactions.png" class="window-screenshot" />
 </a>


<p>This was fun. If anyone attempts a similar journey, I&rsquo;d love to hear about it, especially if visualizations are working.</p>

            </div>
            </article>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="disqus_thread"></div>
<script>





(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://orange-4.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
</div>
<script type="text/javascript">
    $(document).ready(function() {
        $('#blog_images_').lightGallery({
        thumbnail: false,
        selector: 'a:has(img)',
        width: '60%',
        mode: 'lg-fade',
        counter: false,
        download: false,
        enableSwipe: false,
        enableDrag: false,
        speed: 1,
        useLeft: true,
        hideBarsDelay: 1000
    });
    });
</script>

        </div>
    </div>
    <footer class="footer">
        <div class="container">
            <div class="row">

                <div class="col-md-4 col-sm-6 col-xs-12">
                    <div class="row">

                        <div class="col-sm-4 sitemap-group">
                            <ul class="links list-sitemap">
                                <li><b><div class="sitemap-cat">Orange</div></b></li>
                                <li><a class="sitemap-sub" href="/faq/">FAQ</a></li>
                                <li><a class="sitemap-sub" href="/license/">License</a></li>
                                <li><a class="sitemap-sub" href="/privacy/">Privacy</a></li>
                                <li><a class="sitemap-sub" href="/citation/">Citation</a></li>
                                <li><a class="sitemap-sub" href="/contact/">Contact</a></li>
                            </ul>
                        </div>

                        <div class="col-sm-4 sitemap-group">
                            <ul class="links list-sitemap">
                                <li><div class="sitemap-cat">Download</div></li>
                                <li><a class="sitemap-sub" href="/download/#windows">Windows</a></li>
                                <li><a class="sitemap-sub" href="/download/#macos">Mac OS</a></li>
                                
                            </ul>
                        </div>

                        <div class="col-sm-4 sitemap-group">

                            <ul class="links list-sitemap">
                                <li><b><div class="sitemap-cat">Community</div></b></li>
                                <li><a class="sitemap-sub" href="https://www.facebook.com/orangedatamining" target="_blank">Facebook</a></li>
                                <li><a class="sitemap-sub" href="https://www.youtube.com/channel/UClKKWBe2SCAEyv7ZNGhIe4g" target="_blank">YouTube</a></li>
                                <li><a class="sitemap-sub" href="https://twitter.com/orangedataminer" target="_blank">Twitter</a></li>
                                <li><a class="sitemap-sub" href="https://datascience.stackexchange.com/questions/tagged/orange" target="_blank">Stack Exchange</a></li>
                                <li><a class="sitemap-sub" href="https://discord.gg/FWrfeXV" target="_blank">Discord</a></li>
                            </ul>

                        </div>

                    </div>
                </div>

                <div class="col-md-3 col-sm-6 col-xs-12">
                    <div class="row">

                        <div class="col-sm-5 col-md-7 col-lg-6 sitemap-group docs-devs">
                            <ul class="links list-sitemap">
                                <li><div class="sitemap-cat">Documentation</div></li>
                                <li><a class="sitemap-sub" href='/getting-started/'>Get started</a></li>
                                <li><a class="sitemap-sub" href="/widget-catalog/">Widgets</a></li>
                                <li><a class="sitemap-sub" href="http://docs.biolab.si/3/data-mining-library/">Scripting</a></li>
                            </ul>
                        </div>

                        <div class="col-sm-3 sitemap-group">
                            <ul class="links list-sitemap">
                                <li><b><div class="sitemap-cat">Developers</div></b></li>
                                <li><a class="sitemap-sub" target="_blank" href="https://github.com/biolab/orange3">GitHub</a></li>
                                <li><a class="sitemap-sub" target="_blank" href="http://docs.biolab.si/3/development/">Getting Started</a></li>
                            </ul>
                        </div>

                    </div>
                </div>

                <div class="col-md-5 col-sm-12 col-xs-12 sitemap-group">
                    <div class="latest-blog-posts">
                        <ul class="links list-sitemap" style="padding-bottom: 10px">
                            <li><b><a class="sitemap-cat" href="/blog/">Latest blog posts</a></b></li>
                            
                            <li>
                            <div class="row">
                            <div class="col-md-2"><a class="sitemap-sub"> 25 Nov </a></div>
                            <div class="col-md-10">
                                <a class="sitemap-sub" style="color: #f79211" href="/blog/2022/2022-25-11-clustering-videos/">New Orange video series</a>
                            </div>
                            </div>
                            </li>
                            
                            <li>
                            <div class="row">
                            <div class="col-md-2"><a class="sitemap-sub"> 14 Nov </a></div>
                            <div class="col-md-10">
                                <a class="sitemap-sub" style="color: #f79211" href="/blog/2022/2022-11-14-orange-in-a-syncrotron/">Orange in a synchrotron</a>
                            </div>
                            </div>
                            </li>
                            
                            <li>
                            <div class="row">
                            <div class="col-md-2"><a class="sitemap-sub"> 10 Oct </a></div>
                            <div class="col-md-10">
                                <a class="sitemap-sub" style="color: #f79211" href="/blog/2022/2022-10-10-quick-preview/">Quick previews in Orange widgets</a>
                            </div>
                            </div>
                            </li>
                            
                        </ul>
                    </div>
                </div>

            </div>

            <div class="row footer-pad">
                <div class="col-xs-12">
                    <small class="copyright pull-left"  >Copyright © University of Ljubljana</small>
                </div>
            </div>
        </div>
    </footer>

    </body>
</html>