<html><head><title>Orange Data Mining - Editing the photographs collection with the help of machine learning</title><meta property="og:title" content="Editing the photographs collection with the help of machine learning"><meta property="og:description" content="How to use Orange's image embedding to identify similar images, classify them in categories and make an order in your photographs collection?"><meta property="og:image" content="/blog_img/2022/2022-02-11-grid-title.jpg"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Orange Data Mining Toolbox"><meta name=author content="Bioinformatics Laboratory, University of Ljubljana"><meta name=google-site-verification content="DS7GH5M7ABi78pIC2rMcTBFx-UeBFObXOeLvR7Ow3EQ"><link rel="shortcut icon" href=/images/favicon.ico><link href='https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic' rel=stylesheet type=text/css><link href='https://fonts.googleapis.com/css?family=Covered+By+Your+Grace' rel=stylesheet type=text/css><link rel=stylesheet href=/plugins/bootstrap/css/bootstrap.min.css><link rel=stylesheet href=/plugins/font-awesome/css/font-awesome.css><link rel=stylesheet href=/plugins/lightgallery/css/lightgallery.css><link href=https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css rel=stylesheet><link rel=stylesheet href=/scss/main.58e8531e166454b3665e4c7132aa2f1762a5569c179efa4bbf56b266ce93bfac.css><script id=dsq-count-scr src=//orange-4.disqus.com/count.js async></script><noscript><style>.jsonly{display:none!important}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-J6PJZF75EX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J6PJZF75EX",{anonymize_ip:!1})}</script><script type=text/javascript src=/plugins/jquery-1.10.2.min.js></script>
<script type=text/javascript src=/plugins/jquery.form.js></script>
<script type=text/javascript src=/plugins/bootstrap/js/bootstrap.min.js></script>
<script type=text/javascript src=/plugins/lightgallery/js/lightgallery.js></script>
<script type=text/javascript src=/plugins/lightgallery/js/lg-thumbnail.js></script>
<script type=text/javascript src=/plugins/lightgallery/js/lg-video.js></script>
<script type=text/javascript src=/plugins/lightgallery/js/lg-zoom.js></script>
<script type=text/javascript src=/js/custom.js></script>
<script type=text/javascript src=/js/header_helpers.js></script>
<script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-T5X4T27")</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T5X4T27" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script type=text/javascript>$(document).ready(function(){$("a").off("click").click(function(e){ga("send","event","a",e.type,$(this).attr("id"),1)}),$("[class *= trackClicks_]").off("click").click(function(e){var n=$(this).attr("class").split(/\s+/),t="";$.each(n,function(e,n){n.indexOf("trackClicks_")===0&&(t=n)}),ga("send","event","a",e.type,t,1)})})</script></head><body><header id=top class="header navbar-fixed-top"><div class=container><h1 class="logo pull-left"><a id=header-orangelogo href=/><img id=logo-image class=logo-image src=/images/orange_logo_hq.png alt=Logo></a></h1><nav id=main-nav class="main-nav navbar-right" role=navigation><div class=navbar-header><button class=navbar-toggle type=button data-toggle=collapse data-target=#navbar-collapse>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button></div><div class="navbar-collapse collapse" id=navbar-collapse><ul class="nav navbar-nav"><li class=nav-item><a id=header-screenshots-link href=/screenshots/>Screenshots</a></li><li class=nav-item><a id=header-screenshots-link href=/workflows/>Workflows</a></li><li class=nav-item><a id=header-screenshots-link href=/download/>Download</a></li><li class=nav-item><a id=header-screenshots-link href=/blog/>Blog</a></li><li class=nav-item><a id=header-screenshots-link href=/docs/>Docs</a></li><li class=nav-item><a id=header-screenshots-link href=/training/>Workshops</a></li><li class=nav-search-wrapper><div><a class="btn nav-btn-search btn-warning nav-btn fa fa-search nav-btn-desktop" id=search-btn-js role=button></a><a class="btn nav-btn-search btn-warning nav-btn fa fa-search nav-btn-mobile" role=button href="/search/?q="></a><input type=text class="header-search-input jsonly search-widget-workflow nav-item" id=search-header placeholder=Search tabindex=1 onkeydown=check_key_header(event) hidden autofocus></div></li><li><div class="donate-button transform_header donate_div"><a class="btn btn-warning nav-btn" id=header-donate-link role=button target=_blank href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=A76TAX87ZVR3J">Donate</a></div></li></ul></div></nav></div></header><div id=main><div class="container-fluid clear-top"><div id=overflow-container class=overflow-container><div id=loop-container class="offset-header container"><div class="blog-font-size post type-post status-publish format-standard category-standard category-travel full-without-featured odd excerpt-1 no-image"><div class="entry-meta remove-padding-l-r"><span>Categories:</span>
<span class=category><a href=/blog/orange>orange</a></span>
<span class=category><span>|</span>
<a href=/blog/image-analytics>image analytics</a></span>
<span class=category><span>|</span>
<a href=/blog/images>images</a></span>
<span class=category><span>|</span>
<a href=/blog/machine-learning>machine learning</a></span></div><div class='entry-header remove-padding-l-r'><h1 class=entry-title>Editing the photographs collection with the help of machine learning</h1><span class=author-blog>By: Primož Godec,
Feb 11, 2022</span></div><div class="entry-container remove-padding-l-r"><div class="entry-content md"><article><div id=blog_images_><p>The core element of Orange&rsquo;s image analysis is embedding images in the vector space. Last year, we upgraded the embedding server infrastructure, enabling around ten times faster image embedding.</p><p>We switched from an old cluster with a fixed number of workers for each embedding to a new infrastructure where workers turn on when needed. It means that when a user sends images to the embedder, it will turn on as many instances as required until processors&rsquo; cores are available. Inception-v3, VGG16, and VGG19 embedders also perform computation on GPU, making them even faster.</p><p>We also made some modifications in the implementation on Orange&rsquo;s part, making embedding more reliable.</p><h3 id=how-does-embedding-work>How does embedding work?</h3><p><a href=/widget-catalog/image-analytics/imageembedding/>The Image Embedding widget</a> gets the table with images&rsquo; metadata such as an image name, location and size, but they are not ready for analysis. Images are sent to the server to be embedded in a format understandable to machine learning algorithms. The server pushes images through a pre-trained deep neural network and returns the number vectors to the widget.</p><a href=/blog_img/2022/2022-02-11-image-embedding-widget.jpg class=blog-image_><img src=/blog_img/2022/2022-02-11-image-embedding-widget.jpg class=window-screenshot></a><p>Deep neural networks are trained on various specific tasks. <a href=https://arxiv.org/abs/1512.00567>Inception v3</a>, <a href=https://arxiv.org/abs/1409.1556>VGG16, VGG19</a> and <a href=https://arxiv.org/abs/1602.07360>SqueezeNet</a> are trained to classify images into 1000 classes according to the object at the image. <a href=https://www.nature.com/articles/s41467-019-12397-x>Painters</a> are trained to predict paintings&rsquo; authors, <a href=https://pubmed.ncbi.nlm.nih.gov/29036616/>DeepLoc</a> to predict yeast&rsquo;s cells structures and <a href=https://ieeexplore.ieee.org/document/8373812>OpenFace</a> for face recognition. We disregard the classification layer of the network and consider the penultimate layer instead and use that for the image&rsquo;s vector-based representation.</p><h3 id=editing-photo-collection>Editing photo collection</h3><p>I have taken many photographs in the last few years, but I have not had the time to edit the collection. I want to sort them into subfolders based on the categories. Can machine learning algorithms and image embeddings help me with that?</p><p>This blog post will show two approaches for identifying categories and sorting images. The first one is unsupervised, and the second one is supervised.</p><p>First, we load photos. We load a folder of images with a collection that we would like to sort in the subfolders (<a href=https://github.com/PrimozGodec/datasets/blob/master/image-analytics-collection/test-photos.zip>download dataset</a>).</p><a href=/blog_img/2022/2022-02-11-inspect-images.jpg class=blog-image_><img src=/blog_img/2022/2022-02-11-inspect-images.jpg class=window-screenshot></a><p>Both approaches will include embedding images. We connect the <a href=/widget-catalog/image-analytics/imageembedding/>Image Embedding</a> widget to the Import Images widget to embed pictures and select <strong>Inception v3 embedder</strong>.</p><p><em>Our server deletes all images immediately after embedding. If you would not like to share your photos with our server anyway, you can select the SqueezeNet embedder that embeds images at your computer.</em></p><a href=/blog_img/2022/2022-02-11-image-embedding.jpg class=blog-image_><img src=/blog_img/2022/2022-02-11-image-embedding.jpg class=window-screenshot></a><p>The Image Embedding widget added 2048 columns with numbers to each image in the data table. Those numbers describe properties that neural networks inferred from pictures. Numbers are not understandable to humans but make sense to machine learning algorithms.</p><h3 id=image-grid-will-place-similar-photographs-closer-on-the-grid>Image grid will place similar photographs closer on the grid</h3><p><a href=/widget-catalog/image-analytics/imagegrid/>The Image Grid</a> uses <a href=/widget-catalog/unsupervised/tsne/>t-sne embedding</a> to project images on 2-dimensional plane based on their image embeddings. More similar images will be closer in the plot.</p><p>We passed embedded images from the Image Embedding to the Image Grid widget.</p><a href=/blog_img/2022/2022-02-11-image-grid.jpg class=blog-image_><img src=/blog_img/2022/2022-02-11-image-grid.jpg class=window-screenshot></a><p>Image Grid has placed similar images closer in the grid. For example, in the top right corner are images of food, in the top left corner are photos of cities, on the right side are pictures of mountains, and at the bottom left are images of sunsets. The Image Grid had more difficulties with snowy photos. Some are placed at the bottom (they seem to include some mountain image elements), and three central ones seem to have elements of cities, mountains and snow.</p><p>Since images that belong to the same group are close together, it is easy to mark groups of images manually (colours around images). Marked groups are in the output table as class attributes. We can save them on the computer such that each group is a separate folder with <a href=/widget-catalog/image-analytics/saveimages>the Save Images widget</a>.</p><p><strong>Related:</strong> <a href=/blog/2017/04/03/image-analytics-clustering/ target=_blank>Image Analytics: Clustering</a></p><h3 id=training-the-model-to-sort-images>Training the model to sort images</h3><p>The Image Grid is excellent to discover similar images. Still, it is not practical to sort photos into category groups. If we would like to do that more often, we would always need to assign images to groups manually. Can we have a pipeline that would allow us to make a model that we can reuse later when we take new photos s?</p><p><strong>Related</strong>: <a href="https://www.youtube.com/watch?v=lvgx62a8XQk&amp;list=PLmNPvQr9Tf-aRstY69vGAPO_c5RaceBhN&amp;index=1&amp;ab_channel=OrangeDataMining" target=_blank>Video on image classification</a></p><p>We can train a classification model that will mark images with categories.</p><p>We prepared a separate training dataset with pictures in 5 subfolders. Folders are named: city, food, mountains, sunsets and winter. Names of the folders define categories; once the model is trained, it will always classify images in those categories.</p><p>We will first test how accurate the model is.</p><a href=/blog_img/2022/2022-02-11-test-and-score.jpg class=blog-image_><img src=/blog_img/2022/2022-02-11-test-and-score.jpg class=window-screenshot></a><p><a href=/widget-catalog/image-analytics/importimages/>The Import Images</a> widget loads images from the training dataset (<a href=https://github.com/PrimozGodec/datasets/raw/master/image-analytics-collection/train-photos.zip>download the training data</a>). Since images are sorted in multiple folders, the widget assigns the folder name to images as a category, which we can see in the Data Table. We embed images with Inception v3 embedder in <a href=(/widget-catalog/image-analytics/imageembedding/)>the Image Embedding widget</a> and performs cross-validation in <a href=/widget-catalog/evaluate/testandscore>the Test and Score widget</a>. The model we use is logistic regression. We are happy with the model with AUC 0.992 and classification accuracy of 0.943.</p><p>Now we can train the model that will be used to label an unlabeled set of photos.</p><a href=/blog_img/2022/2022-02-11-image-classification.jpg class=blog-image_><img src=/blog_img/2022/2022-02-11-image-classification.jpg class=window-screenshot></a><p>We train <a href=/widget-catalog/model/logisticregression>the logistic regression model</a> on the training images in the top branch on the labelled training dataset. Data that we want to label (sort in subfolders) are loaded and embedded in the bottom branch. We use <a href=https://github.com/PrimozGodec/datasets/blob/master/image-analytics-collection/test-photos.zip>the same images</a> as in the first part of the blog. <a href=/widget-catalog/evaluate/predictions>The Predictions widget</a> assigns labels to the images based on the logistic regression model.</p><p>We use <a href=/widget-catalog/image-analytics/imageviewer>the Image Viewer</a> to inspect assigned labels to images. Labels seem to be meaningful and correct. Now that we have photos labelled, we save them to the folder structure with <a href=/widget-catalog/image-analytics/saveimages>the Save Images widget</a> such that each folder is one category. Since the Prediction widget places predictions (column named Logistic Regression) in the meta part of the table, we need to first set the attribute as a target with the Select Columns widget &mdash; the Save Images widget uses the target column as a subfolder name.</p><p>We also connected <a href=/widget-catalog/model/savemodel>the Save Model widget</a> to the Logistic Regression. This way, the model is saved for later and can be reused.</p><h3 id=want-to-learn-more>Want to learn more?</h3><p>We showed two ways of analysing images with Orange&rsquo;s Image Analytics module. The Image Grid is a great tool to identify similar images and see them in the grid. The second one needs an extra effort to prepare a training dataset, but this leads to an automatic pipeline to identify categories.</p><p>If you want to learn more about Image Analysis in Orange <a href="https://youtube.com/playlist?list=PLmNPvQr9Tf-aRstY69vGAPO_c5RaceBhN">watch the tutorial wideos</a> or read related blogs: <a href=/blog/2017/04/03/image-analytics-clustering/%5D>Image Analytics: Clustering</a>, <a href=/blog/2018/05/09/clustering-of-monet-and-manet/>Clustering of Monet and Manet</a>, and <a href=/blog/2017/04/25/outliers-in-traffic-signs/>Outliers in Traffic Signs</a></p></div></article></div></div></div></div></div><div id=disqus_thread></div><script>(function(){var e=document,t=e.createElement("script");t.src="https://orange-4.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><script type=text/javascript>$(document).ready(function(){$("#blog_images_").lightGallery({thumbnail:!1,selector:"a:has(img)",width:"60%",mode:"lg-fade",counter:!1,download:!1,enableSwipe:!1,enableDrag:!1,speed:1,useLeft:!0,hideBarsDelay:1e3})})</script></div></div><footer class=footer><div class=container><div class=row><div class="col-md-4 col-sm-6 col-xs-12"><div class=row><div class="col-sm-4 sitemap-group"><ul class="links list-sitemap"><li><b><div class=sitemap-cat>Orange</div></b></li><li><a class=sitemap-sub href=/faq/>FAQ</a></li><li><a class=sitemap-sub href=/license/>License</a></li><li><a class=sitemap-sub href=/privacy/>Privacy</a></li><li><a class=sitemap-sub href=/citation/>Citation</a></li><li><a class=sitemap-sub href=/contact/>Contact</a></li></ul></div><div class="col-sm-4 sitemap-group"><ul class="links list-sitemap"><li><div class=sitemap-cat>Download</div></li><li><a class=sitemap-sub href=/download/#windows>Windows</a></li><li><a class=sitemap-sub href=/download/#macos>Mac OS</a></li></ul></div><div class="col-sm-4 sitemap-group"><ul class="links list-sitemap"><li><b><div class=sitemap-cat>Community</div></b></li><li><a class=sitemap-sub href=https://www.facebook.com/orangedatamining target=_blank>Facebook</a></li><li><a class=sitemap-sub href=https://www.youtube.com/channel/UClKKWBe2SCAEyv7ZNGhIe4g target=_blank>YouTube</a></li><li><a class=sitemap-sub href=https://twitter.com/orangedataminer target=_blank>Twitter</a></li><li><a class=sitemap-sub href=https://datascience.stackexchange.com/questions/tagged/orange target=_blank>Stack Exchange</a></li><li><a class=sitemap-sub href=https://discord.gg/FWrfeXV target=_blank>Discord</a></li></ul></div></div></div><div class="col-md-3 col-sm-6 col-xs-12"><div class=row><div class="col-sm-5 col-md-7 col-lg-6 sitemap-group docs-devs"><ul class="links list-sitemap"><li><div class=sitemap-cat>Documentation</div></li><li><a class=sitemap-sub href=/getting-started/>Get started</a></li><li><a class=sitemap-sub href=/widget-catalog/>Widgets</a></li><li><a class=sitemap-sub href=http://docs.biolab.si/3/data-mining-library/>Scripting</a></li></ul></div><div class="col-sm-3 sitemap-group"><ul class="links list-sitemap"><li><b><div class=sitemap-cat>Developers</div></b></li><li><a class=sitemap-sub target=_blank href=https://github.com/biolab/orange3>GitHub</a></li><li><a class=sitemap-sub target=_blank href=http://docs.biolab.si/3/development/>Getting Started</a></li></ul></div></div></div><div class="col-md-5 col-sm-12 col-xs-12 sitemap-group"><div class=latest-blog-posts><ul class="links list-sitemap" style=padding-bottom:10px><li><b><a class=sitemap-cat href=/blog/>Latest blog posts</a></b></li><li><div class=row><div class=col-md-2><a class=sitemap-sub>19 Sep</a></div><div class=col-md-10><a class=sitemap-sub style=color:#f79211 href=/blog/2023/2023-09-19-fairness-reweighing-dataset/>Orange Fairness - Reweighing a Dataset</a></div></div></li><li><div class=row><div class=col-md-2><a class=sitemap-sub>18 Sep</a></div><div class=col-md-10><a class=sitemap-sub style=color:#f79211 href=/blog/2023/2023-09-18-fairness-dataset-bias/>Orange Fairness - Dataset Bias</a></div></div></li><li><div class=row><div class=col-md-2><a class=sitemap-sub>31 Aug</a></div><div class=col-md-10><a class=sitemap-sub style=color:#f79211 href=/blog/2023/2023-08-31-a-dash-of-dask/>A dash of Dask</a></div></div></li></ul></div></div></div><div class="row footer-pad"><div class=col-xs-12><small class="copyright pull-left">Copyright © University of Ljubljana</small></div></div></div></footer></body></html>