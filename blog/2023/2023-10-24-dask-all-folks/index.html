<html><head><title>Orange Data Mining - Dask all Folks: preparing large datasets</title><meta property="og:title" content="Dask all Folks: preparing large datasets"><meta property="og:description" content="Preparing large HDF5 datasets that load into Orange as on-disk data."><meta property="og:image" content="/blog_img/2023/2023-10-24-dask-all-folks.png"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Orange Data Mining Toolbox"><meta name=author content="Bioinformatics Laboratory, University of Ljubljana"><meta name=google-site-verification content="DS7GH5M7ABi78pIC2rMcTBFx-UeBFObXOeLvR7Ow3EQ"><link rel="shortcut icon" href=/images/favicon.ico><link href='https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic' rel=stylesheet type=text/css><link href='https://fonts.googleapis.com/css?family=Covered+By+Your+Grace' rel=stylesheet type=text/css><link rel=stylesheet href=/plugins/bootstrap/css/bootstrap.min.css><link rel=stylesheet href=/plugins/font-awesome/css/font-awesome.css><link rel=stylesheet href=/plugins/lightgallery/css/lightgallery.css><link href=https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css rel=stylesheet><link rel=stylesheet href=/scss/main.58e8531e166454b3665e4c7132aa2f1762a5569c179efa4bbf56b266ce93bfac.css><script id=dsq-count-scr src=//orange-4.disqus.com/count.js async></script><noscript><style>.jsonly{display:none!important}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-J6PJZF75EX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J6PJZF75EX",{anonymize_ip:!1})}</script><script type=text/javascript src=/plugins/jquery-1.10.2.min.js></script>
<script type=text/javascript src=/plugins/jquery.form.js></script>
<script type=text/javascript src=/plugins/bootstrap/js/bootstrap.min.js></script>
<script type=text/javascript src=/plugins/lightgallery/js/lightgallery.js></script>
<script type=text/javascript src=/plugins/lightgallery/js/lg-thumbnail.js></script>
<script type=text/javascript src=/plugins/lightgallery/js/lg-video.js></script>
<script type=text/javascript src=/plugins/lightgallery/js/lg-zoom.js></script>
<script type=text/javascript src=/js/custom.js></script>
<script type=text/javascript src=/js/header_helpers.js></script>
<script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-T5X4T27")</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T5X4T27" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script type=text/javascript>$(document).ready(function(){$("a").off("click").click(function(e){ga("send","event","a",e.type,$(this).attr("id"),1)}),$("[class *= trackClicks_]").off("click").click(function(e){var n=$(this).attr("class").split(/\s+/),t="";$.each(n,function(e,n){n.indexOf("trackClicks_")===0&&(t=n)}),ga("send","event","a",e.type,t,1)})})</script></head><body><header id=top class="header navbar-fixed-top"><div class=container><h1 class="logo pull-left"><a id=header-orangelogo href=/><img id=logo-image class=logo-image src=/images/orange_logo_hq.png alt=Logo></a></h1><nav id=main-nav class="main-nav navbar-right" role=navigation><div class=navbar-header><button class=navbar-toggle type=button data-toggle=collapse data-target=#navbar-collapse>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button></div><div class="navbar-collapse collapse" id=navbar-collapse><ul class="nav navbar-nav"><li class=nav-item><a id=header-screenshots-link href=/screenshots/>Screenshots</a></li><li class=nav-item><a id=header-screenshots-link href=/workflows/>Workflows</a></li><li class=nav-item><a id=header-screenshots-link href=/download/>Download</a></li><li class=nav-item><a id=header-screenshots-link href=/blog/>Blog</a></li><li class=nav-item><a id=header-screenshots-link href=/docs/>Docs</a></li><li class=nav-item><a id=header-screenshots-link href=/training/>Workshops</a></li><li class=nav-search-wrapper><div><a class="btn nav-btn-search btn-warning nav-btn fa fa-search nav-btn-desktop" id=search-btn-js role=button></a><a class="btn nav-btn-search btn-warning nav-btn fa fa-search nav-btn-mobile" role=button href="/search/?q="></a><input type=text class="header-search-input jsonly search-widget-workflow nav-item" id=search-header placeholder=Search tabindex=1 onkeydown=check_key_header(event) hidden autofocus></div></li><li><div class="donate-button transform_header donate_div"><a class="btn btn-warning nav-btn" id=header-donate-link role=button target=_blank href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=A76TAX87ZVR3J">Donate</a></div></li></ul></div></nav></div></header><div id=main><div class="container-fluid clear-top"><div id=overflow-container class=overflow-container><div id=loop-container class="offset-header container"><div class="blog-font-size post type-post status-publish format-standard category-standard category-travel full-without-featured odd excerpt-1 no-image"><div class="entry-meta remove-padding-l-r"><span>Categories:</span>
<span class=category><a href=/blog/dask>dask</a></span>
<span class=category><span>|</span>
<a href=/blog/development>development</a></span></div><div class='entry-header remove-padding-l-r'><h1 class=entry-title>Dask all Folks: preparing large datasets</h1><span class=author-blog>By: Noah Novšak,
Oct 24, 2023</span></div><div class="entry-container remove-padding-l-r"><div class="entry-content md"><article><div id=blog_images_><p>Today, we will delve into the exciting world of Dask once again, and explore how to finally bring your own data into Orange. Or, more precisely, into an <a href=https://github.com/biolab/orange3/wiki/Orange-with-Dask>experimental version of Orange that supports Dask</a>.</p><p>If you&rsquo;ve already set up your data as an Orange Table and you would just like to re-encode it to better support dask, then all you have to do is export it again as a <code>.hdf5</code> file. This is done either with the <em>Save Data</em> widget (choose &ldquo;Orange on-disk data&rdquo; as the file type) or in <em>python</em> like so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>table <span style=color:#f92672>=</span> Table(<span style=color:#e6db74>&#39;my_data.tab&#39;</span>)
</span></span><span style=display:flex><span>table<span style=color:#f92672>.</span>save(<span style=color:#e6db74>&#39;my_data.hdf5&#39;</span>)
</span></span></code></pre></div><p>Simple as that, end of blog, see you next time!</p><p>Well, not quite. For everyone that has a bunch of data in some other format, it&rsquo;s not quite as simple. So here&rsquo;s a short guide on preparing your data for Orange.</p><p>First of all I&rsquo;ll assume your data can be read in python into something resembling a <a href=https://numpy.org/>numpy</a> array. If that is not the case, your first step will be to make it so. Next, in addition to the array you will also need to make a <em>domain</em> for your data. That is where we store all the extra information that describes the contents of your data (feature names, types, target variables, etc.).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> table <span style=color:#f92672>=</span> Table(<span style=color:#e6db74>&#39;heart_disease&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> table<span style=color:#f92672>.</span>domain<span style=color:#f92672>.</span>attributes
</span></span><span style=display:flex><span>(ContinuousVariable(name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;age&#39;</span>, number_of_decimals<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>),
</span></span><span style=display:flex><span> DiscreteVariable(name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;gender&#39;</span>, values<span style=color:#f92672>=</span>(<span style=color:#e6db74>&#39;female&#39;</span>, <span style=color:#e6db74>&#39;male&#39;</span>)),
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span></code></pre></div><p>Usually in a <code>.csv</code> or <code>.tab</code> file we would write this information in the header (the first or first three rows). But the <a href=https://www.hdfgroup.org/solutions/hdf5>HDF5</a> format is somewhat different. It is very flexible and allows information to be stored in many different ways. So we&rsquo;ve had to come up with a consistent way to save this information that is as true to the internal structure of our table a possible and simple to implement even outside orange. What we&rsquo;ve settled on (depicted in the diagram below) is to make separate arrays to store the raw data, and an extra group to hold the additional information.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>├── X (Data)
</span></span><span style=display:flex><span>├── Y (Class Data)
</span></span><span style=display:flex><span>├── metas (Meta Data)
</span></span><span style=display:flex><span>│   ├── 0 (Column 1)
</span></span><span style=display:flex><span>│   ├── 1 (Column 2)
</span></span><span style=display:flex><span>│   └── ... (Additional columns)
</span></span><span style=display:flex><span>└── domain
</span></span><span style=display:flex><span>    ├── attributes/class_vars/metas (Domain)
</span></span><span style=display:flex><span>    └── attributes_args/class_vars_args/metas_args (Optional)
</span></span></code></pre></div><p>Now let&rsquo;s try to apply this idea on an actual dataset! The simplest approach is to use a library like <a href=https://www.h5py.org/>h5py</a>, this way it boils down to just a couple lines of code. First we can save our data arrays, (note that due to data types the <em>metas</em> array is split up and saved by columns).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>with</span> h5py<span style=color:#f92672>.</span>File(<span style=color:#e6db74>&#39;my_data.hdf5&#39;</span>, <span style=color:#e6db74>&#39;w&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>    f<span style=color:#f92672>.</span>create_dataset(<span style=color:#e6db74>&#39;X&#39;</span>, data<span style=color:#f92672>=</span>x_array)
</span></span><span style=display:flex><span>    f<span style=color:#f92672>.</span>create_dataset(<span style=color:#e6db74>&#39;Y&#39;</span>, data<span style=color:#f92672>=</span>y_array)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> data_metas<span style=color:#f92672>.</span>shape[<span style=color:#ae81ff>1</span>]:
</span></span><span style=display:flex><span>        f<span style=color:#f92672>.</span>create_dataset(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;metas/</span><span style=color:#e6db74>{</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>, data<span style=color:#f92672>=</span>metas_array[:, i])
</span></span></code></pre></div><p>The next step is to make and store our domain. We&rsquo;ll have to make separate arrays for each of our attributes, class variables and meta attributes, and save them with the appropriate names. These &lsquo;domain&rsquo; arrays should consist of two columns, indicating the name and type of each feature (each row representing one column of data).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>attributes <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array(
</span></span><span style=display:flex><span>    [[<span style=color:#e6db74>&#39;age&#39;</span>, <span style=color:#e6db74>&#39;c&#39;</span>], <span style=color:#75715e># ContinuousVariable(name=&#39;age&#39;)</span>
</span></span><span style=display:flex><span>     [<span style=color:#e6db74>&#39;gender&#39;</span>, <span style=color:#e6db74>&#39;d&#39;</span>], <span style=color:#75715e># DiscreteVariable(name=&#39;gender&#39;)</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>...</span>],
</span></span><span style=display:flex><span>    dtype<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;S&#39;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>class_vars <span style=color:#f92672>=</span> <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> h5py<span style=color:#f92672>.</span>File(<span style=color:#e6db74>&#39;my_data.hdf5&#39;</span>, <span style=color:#e6db74>&#39;r+&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>    domain <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>create_group(<span style=color:#e6db74>&#39;domain&#39;</span>)
</span></span><span style=display:flex><span>    domain<span style=color:#f92672>.</span>create_dataset(<span style=color:#e6db74>&#39;attributes&#39;</span>, data<span style=color:#f92672>=</span>attributes)
</span></span><span style=display:flex><span>    domain<span style=color:#f92672>.</span>creat_dataset(<span style=color:#e6db74>&#39;class_vars&#39;</span>, data<span style=color:#f92672>=</span>class_vars)
</span></span></code></pre></div><p>Remember the <em>heart-disease</em> table from the example above? Well you can see that the domain contains a little bit more than just the name and type of variables. Continuous variables can specify how accurate they are and discrete variables can also represent non-numeric data by specifying values. These parameters can be saved in our domain in seperate (optional) arrays. Because this additional information can be quite complex and varied though, we decided the most reasonable way to save them is to use <a href=https://www.json.org/json-en.html>json</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>attributes_args <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array(
</span></span><span style=display:flex><span>    [[<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{number_of_decimals: 0}</span><span style=color:#e6db74>&#39;</span>],
</span></span><span style=display:flex><span>     [<span style=color:#e6db74>&#39;{values: (&#34;female&#34;, &#34;male&#34;)}&#39;</span>],
</span></span><span style=display:flex><span>     <span style=color:#f92672>...</span>],
</span></span><span style=display:flex><span>    dtype<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;S&#39;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> h5py<span style=color:#f92672>.</span>File(<span style=color:#e6db74>&#39;my_data.hdf5&#39;</span>, <span style=color:#e6db74>&#39;r+&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>    domain <span style=color:#f92672>=</span> f[<span style=color:#e6db74>&#39;domain&#39;</span>]
</span></span><span style=display:flex><span>    domain<span style=color:#f92672>.</span>create_dataset(<span style=color:#e6db74>&#39;attributes_args&#39;</span>, data<span style=color:#f92672>=</span>attributes_args)
</span></span></code></pre></div><p>That&rsquo;s it! Now you can create your own <code>.hdf5</code> datasets and start processing them in Orange. Remember, you will need the experimental Orange version from the <em>dask</em> branch: <a href=https://github.com/biolab/orange3/wiki/Orange-with-Dask>see installation instructions</a>.</p></div></article></div></div></div></div></div><div id=disqus_thread></div><script>(function(){var e=document,t=e.createElement("script");t.src="https://orange-4.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><script type=text/javascript>$(document).ready(function(){$("#blog_images_").lightGallery({thumbnail:!1,selector:"a:has(img)",width:"60%",mode:"lg-fade",counter:!1,download:!1,enableSwipe:!1,enableDrag:!1,speed:1,useLeft:!0,hideBarsDelay:1e3})})</script></div></div><footer class=footer><div class=container><div class=row><div class="col-md-4 col-sm-6 col-xs-12"><div class=row><div class="col-sm-4 sitemap-group"><ul class="links list-sitemap"><li><b><div class=sitemap-cat>Orange</div></b></li><li><a class=sitemap-sub href=/faq/>FAQ</a></li><li><a class=sitemap-sub href=/license/>License</a></li><li><a class=sitemap-sub href=/privacy/>Privacy</a></li><li><a class=sitemap-sub href=/citation/>Citation</a></li><li><a class=sitemap-sub href=/contact/>Contact</a></li></ul></div><div class="col-sm-4 sitemap-group"><ul class="links list-sitemap"><li><div class=sitemap-cat>Download</div></li><li><a class=sitemap-sub href=/download/#windows>Windows</a></li><li><a class=sitemap-sub href=/download/#macos>Mac OS</a></li></ul></div><div class="col-sm-4 sitemap-group"><ul class="links list-sitemap"><li><b><div class=sitemap-cat>Community</div></b></li><li><a class=sitemap-sub href=https://www.facebook.com/orangedatamining target=_blank>Facebook</a></li><li><a class=sitemap-sub href=https://www.youtube.com/channel/UClKKWBe2SCAEyv7ZNGhIe4g target=_blank>YouTube</a></li><li><a class=sitemap-sub href=https://twitter.com/orangedataminer target=_blank>Twitter</a></li><li><a class=sitemap-sub href=https://datascience.stackexchange.com/questions/tagged/orange target=_blank>Stack Exchange</a></li><li><a class=sitemap-sub href=https://discord.gg/FWrfeXV target=_blank>Discord</a></li></ul></div></div></div><div class="col-md-3 col-sm-6 col-xs-12"><div class=row><div class="col-sm-5 col-md-7 col-lg-6 sitemap-group docs-devs"><ul class="links list-sitemap"><li><div class=sitemap-cat>Documentation</div></li><li><a class=sitemap-sub href=/getting-started/>Get started</a></li><li><a class=sitemap-sub href=/widget-catalog/>Widgets</a></li><li><a class=sitemap-sub href=http://docs.biolab.si/3/data-mining-library/>Scripting</a></li></ul></div><div class="col-sm-3 sitemap-group"><ul class="links list-sitemap"><li><b><div class=sitemap-cat>Developers</div></b></li><li><a class=sitemap-sub target=_blank href=https://github.com/biolab/orange3>GitHub</a></li><li><a class=sitemap-sub target=_blank href=http://docs.biolab.si/3/development/>Getting Started</a></li></ul></div></div></div><div class="col-md-5 col-sm-12 col-xs-12 sitemap-group"><div class=latest-blog-posts><ul class="links list-sitemap" style=padding-bottom:10px><li><b><a class=sitemap-cat href=/blog/>Latest blog posts</a></b></li><li><div class=row><div class=col-md-2><a class=sitemap-sub>24 Oct</a></div><div class=col-md-10><a class=sitemap-sub style=color:#f79211 href=/blog/2023/2023-10-24-dask-all-folks/>Dask all Folks: preparing large datasets</a></div></div></li><li><div class=row><div class=col-md-2><a class=sitemap-sub>20 Oct</a></div><div class=col-md-10><a class=sitemap-sub style=color:#f79211 href=/blog/2023/2023-10-20-porto-conference/>Recap of 26th International Conference on Discovery Science</a></div></div></li><li><div class=row><div class=col-md-2><a class=sitemap-sub>17 Oct</a></div><div class=col-md-10><a class=sitemap-sub style=color:#f79211 href=/blog/2023/2023-09-01-announcement-nomogram/>Fall Season Brings Fresh Content to the Introduction to Data Science Series</a></div></div></li></ul></div></div></div><div class="row footer-pad"><div class=col-xs-12><small class="copyright pull-left">Copyright © University of Ljubljana</small></div></div></div></footer></body></html>